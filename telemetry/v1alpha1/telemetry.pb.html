---
title: istio.telemetry.v1alpha1
layout: protoc-gen-docs
generator: protoc-gen-docs
number_of_entries: 17
---
<h2 id="Telemetry">Telemetry</h2>
<section>
<p>Telemetry defines the telemetry generation policies for workloads within a mesh.
Telemetry policies control runtime configuration of telemetry generation for Istio.</p>

<p>For mesh level configuration, put the policy in root configuration namespace for
your Istio installation <em>without</em> a workload selector.</p>

<p>For any namespace, including the root configuration namespace, it is only valid
to have a single workload selector-less Telemetry resource. In the case of multiples,
the oldest known resource will be used to the exclusion of any other resources.</p>

<p>For resources with a workload selector, it is only valid to have one resource selecting
any given workload. If multiple resources with a workload selector select a single resource,
the oldest known resource will be used to the exclusion of all other resources.</p>

<p>WARNING: Support for Telemetry policies is under active development and is <em>not</em>
stable or supported by Istio at this time.</p>

<p>Examples:</p>

<p>Policy to enable random sampling for 10% of all traffic:</p>

<pre><code class="language-yaml">apiVersion: telemetry.istio.io/v1beta1
kind: Telemetry
metadata:
  name: mesh-default
  namespace: istio-system
spec:
  tracing:
  - match: {} # apply to all traffic
    config:
      reportSpans: true
      percentageSampler:
        target: 10.00
</code></pre>

<p>Policy to disable trace reporting for all inbound traffic to the &ldquo;foo&rdquo;
workloads that arrives on port 8090:</p>

<pre><code class="language-yaml">apiVersion: telemetry.istio.io/v1beta1
kind: Telemetry
metadata:
  name: mesh-default
  namespace: istio-system
spec:
  workloadSelector:
    labels:
      service.istio.io/canonical-name: foo
  tracing:
  - match:
      trafficDirection: INBOUND
      port:
        number: 8090
    config:
      reportSpans: false
</code></pre>

<table class="message-fields">
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
<th>Required</th>
</tr>
</thead>
<tbody>
<tr id="Telemetry-workload_selector">
<td><code>workloadSelector</code></td>
<td><code><a href="https://istio.io/docs/reference/config/type/workload-selector.html#WorkloadSelector">WorkloadSelector</a></code></td>
<td>
<p>Optional. Workload selector decides where to apply the Telemetry policy.
If not set, the Telemetry policy will be applied to all workloads in the
same namespace as the Telemetry policy.</p>

</td>
<td>
No
</td>
</tr>
<tr id="Telemetry-tracing">
<td><code>tracing</code></td>
<td><code><a href="#TracingRule">TracingRule[]</a></code></td>
<td>
<p>Optional. Tracing defines the per-workload overrides for trace span
reporting.</p>

</td>
<td>
No
</td>
</tr>
</tbody>
</table>
</section>
<h2 id="TracingRule">TracingRule</h2>
<section>
<p>TracingRule defines how trace spans should be reported (sampling rate, custom tags)
and under what conditions the reporting should be conducted.</p>

<table class="message-fields">
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
<th>Required</th>
</tr>
</thead>
<tbody>
<tr id="TracingRule-match">
<td><code>match</code></td>
<td><code><a href="#TelemetryRuleMatch">TelemetryRuleMatch</a></code></td>
<td>
<p>Defines the conditions under which the associated configuration applies.</p>

</td>
<td>
No
</td>
</tr>
<tr id="TracingRule-config">
<td><code>config</code></td>
<td><code><a href="#Tracing">Tracing</a></code></td>
<td>
<p>Customization of the default behavior for tracing.</p>

</td>
<td>
No
</td>
</tr>
</tbody>
</table>
</section>
<h2 id="TelemetryRuleMatch">TelemetryRuleMatch</h2>
<section>
<p>TelemetryRuleMatch defines conditions for selecting subsets of mesh traffic
for a workload. TelemetryRuleMatch is concerned with simplified selection
based on listener, protocol, and traffic direction.</p>

<table class="message-fields">
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
<th>Required</th>
</tr>
</thead>
<tbody>
<tr id="TelemetryRuleMatch-traffic_direction">
<td><code>trafficDirection</code></td>
<td><code><a href="#TelemetryRuleMatch-TrafficDirection">TrafficDirection</a></code></td>
<td>
<p>Optional. Specifies the intended direction of the traffic relative to the local proxy.
Defaults to ALL if unset.</p>

</td>
<td>
No
</td>
</tr>
<tr id="TelemetryRuleMatch-port">
<td><code>port</code></td>
<td><code><a href="#Port">Port</a></code></td>
<td>
<p>Optional. The port on which the traffic is received.
Defaults to ALL if unset.</p>

</td>
<td>
No
</td>
</tr>
</tbody>
</table>
</section>
<h2 id="Port">Port</h2>
<section>
<p>Port specifies the number of a port to be used for
matching or selection for final routing.</p>

<table class="message-fields">
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
<th>Required</th>
</tr>
</thead>
<tbody>
<tr id="Port-number">
<td><code>number</code></td>
<td><code>uint32</code></td>
<td>
<p>Valid port number</p>

</td>
<td>
No
</td>
</tr>
</tbody>
</table>
</section>
<h2 id="Tracing">Tracing</h2>
<section>
<p>Tracing defines the workload-level overrides for tracing behavior within
a mesh. It can be used to enable/disable tracing, as well as to set sampling
rates and custom tag extraction.</p>

<table class="message-fields">
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
<th>Required</th>
</tr>
</thead>
<tbody>
<tr id="Tracing-report_spans">
<td><code>reportSpans</code></td>
<td><code>bool</code></td>
<td>
<p>Enables the tracing functionality. When this is set to <code>true</code>, the
sidecar will report spans to a configured backend for all traffic with a trace
context that specifies the trace is sampled. Additionally, spans will be
generated for traffic without trace contexts based on the
<code>sampler</code> configuration provided. If <code>report_spans</code> is <code>false</code> (or unset),
the sidecar will ignore the incoming trace context, generating no spans for
the traffic (the context will be silently forwarded). This is equivalent to
disabling tracing for the sidecar.</p>

</td>
<td>
No
</td>
</tr>
<tr id="Tracing-include_istio_tags">
<td><code>includeIstioTags</code></td>
<td><code>bool</code></td>
<td>
<p>Controls whether or not Istio-specific tags will be generated for each
span created by the sidecar proxies. These tags include information on
the canonical service, meh, and namespace involved in the request.
Default: true</p>

</td>
<td>
No
</td>
</tr>
<tr id="Tracing-custom_tags">
<td><code>customTags</code></td>
<td><code>map&lt;string,&nbsp;<a href="#Tracing-CustomTag">CustomTag</a>&gt;</code></td>
<td>
<p>Optional. Configures additional custom tags to the generated trace spans.</p>

</td>
<td>
No
</td>
</tr>
<tr id="Tracing-max_path_tag_length">
<td><code>maxPathTagLength</code></td>
<td><code>uint32</code></td>
<td>
<p>Optional. Controls the overall path length allowed in a reported span.</p>

</td>
<td>
No
</td>
</tr>
<tr id="Tracing-constant_sampler" class="oneof oneof-start">
<td><code>constantSampler</code></td>
<td><code><a href="#ConstantSampler">ConstantSampler (oneof)</a></code></td>
<td>
<p>A sampler that makes uniform decisions for all Sidecar traffic.</p>

</td>
<td>
No
</td>
</tr>
<tr id="Tracing-percentage_sampler" class="oneof">
<td><code>percentageSampler</code></td>
<td><code><a href="#PercentageSampler">PercentageSampler (oneof)</a></code></td>
<td>
<p>A sampler that selects a configurable percentage of traffic for telemetry generation.</p>

</td>
<td>
No
</td>
</tr>
</tbody>
</table>
</section>
<h2 id="ConstantSampler">ConstantSampler</h2>
<section>
<p>A sampler that makes uniform decisions for all Sidecar traffic.</p>

<table class="message-fields">
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
<th>Required</th>
</tr>
</thead>
<tbody>
<tr id="ConstantSampler-decision">
<td><code>decision</code></td>
<td><code><a href="#ConstantSampler-ConstantDecision">ConstantDecision</a></code></td>
<td>
<p>Controls the behavior of the sampler.</p>

</td>
<td>
No
</td>
</tr>
</tbody>
</table>
</section>
<h2 id="PercentageSampler">PercentageSampler</h2>
<section>
<p>A sampler that selects a configurable percentage of traffic for telemetry generation.</p>

<table class="message-fields">
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
<th>Required</th>
</tr>
</thead>
<tbody>
<tr id="PercentageSampler-target">
<td><code>target</code></td>
<td><code>double</code></td>
<td>
<p>Controls the amount of traffic selected for which no previous
sampling decision has been made. If a prior sampling decision has been
made, that decision will be respected. However, if no sampling decision
has been made (example: no <code>x-b3-sampled</code> tracing header was present in the
requests), the traffic will be selected for telemetry generation at the
percentage specified.
Setting <code>target</code> to 0 is equivalent to
ConstantDecision.NEVER_SAMPLE. Setting <code>target</code> to
100 is equivalent of ConstantDecision.ALWAYS SAMPLE.</p>

<p>Defaults to 0%. Valid values [0.00-100.00]. Can be specified in 0.01%
increments.</p>

</td>
<td>
No
</td>
</tr>
</tbody>
</table>
</section>
<h2 id="Tracing-CustomTag">Tracing.CustomTag</h2>
<section>
<p>CustomTag defines a tag to be added to a trace span that is based on
an operator-supplied value. This value can either be a hard-coded value,
a value taken from an environment variable known to the sidecar proxy, or
from a request header.</p>

<table class="message-fields">
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
<th>Required</th>
</tr>
</thead>
<tbody>
<tr id="Tracing-CustomTag-literal" class="oneof oneof-start">
<td><code>literal</code></td>
<td><code><a href="#Tracing-Literal">Literal (oneof)</a></code></td>
<td>
<p>Literal adds the same, hard-coded value to each span.</p>

</td>
<td>
No
</td>
</tr>
<tr id="Tracing-CustomTag-environment" class="oneof">
<td><code>environment</code></td>
<td><code><a href="#Tracing-Environment">Environment (oneof)</a></code></td>
<td>
<p>Environment adds the value of an environment variable to each span.</p>

</td>
<td>
No
</td>
</tr>
<tr id="Tracing-CustomTag-header" class="oneof">
<td><code>header</code></td>
<td><code><a href="#Tracing-RequestHeader">RequestHeader (oneof)</a></code></td>
<td>
<p>RequestHeader adds the value of an header from the request to each span.</p>

</td>
<td>
No
</td>
</tr>
<tr id="Tracing-CustomTag-metadata" class="oneof">
<td><code>metadata</code></td>
<td><code><a href="#Tracing-Metadata">Metadata (oneof)</a></code></td>
<td>
<p>Metadata adds the value of a metadata field to each span.</p>

</td>
<td>
No
</td>
</tr>
</tbody>
</table>
</section>
<h2 id="Tracing-Literal">Tracing.Literal</h2>
<section>
<table class="message-fields">
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
<th>Required</th>
</tr>
</thead>
<tbody>
<tr id="Tracing-Literal-value">
<td><code>value</code></td>
<td><code>string</code></td>
<td>
<p>The tag value to use.</p>

</td>
<td>
No
</td>
</tr>
</tbody>
</table>
</section>
<h2 id="Tracing-Environment">Tracing.Environment</h2>
<section>
<table class="message-fields">
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
<th>Required</th>
</tr>
</thead>
<tbody>
<tr id="Tracing-Environment-name">
<td><code>name</code></td>
<td><code>string</code></td>
<td>
<p>Name of the environment variable from which to extract the tag value.</p>

</td>
<td>
No
</td>
</tr>
<tr id="Tracing-Environment-default_value">
<td><code>defaultValue</code></td>
<td><code>string</code></td>
<td>
<p>Optional. If the environment variable is not found, this value will be
used instead.</p>

</td>
<td>
No
</td>
</tr>
</tbody>
</table>
</section>
<h2 id="Tracing-RequestHeader">Tracing.RequestHeader</h2>
<section>
<table class="message-fields">
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
<th>Required</th>
</tr>
</thead>
<tbody>
<tr id="Tracing-RequestHeader-name">
<td><code>name</code></td>
<td><code>string</code></td>
<td>
<p>Name of the header from which to extract the tag value.</p>

</td>
<td>
No
</td>
</tr>
<tr id="Tracing-RequestHeader-default_value">
<td><code>defaultValue</code></td>
<td><code>string</code></td>
<td>
<p>Optional. If the header is not found, this value will be
used instead.</p>

</td>
<td>
No
</td>
</tr>
</tbody>
</table>
</section>
<h2 id="Tracing-Metadata">Tracing.Metadata</h2>
<section>
<p>Retrieve the protobuf value from Metadata, and populate the tag
value with the canonical JSON representation of it.</p>

<table class="message-fields">
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
<th>Required</th>
</tr>
</thead>
<tbody>
<tr id="Tracing-Metadata-kind">
<td><code>kind</code></td>
<td><code><a href="#Tracing-Metadata-Kind">Kind</a></code></td>
<td>
<p>Kind of metadata from which to obtain tag value.</p>

</td>
<td>
No
</td>
</tr>
<tr id="Tracing-Metadata-key">
<td><code>key</code></td>
<td><code><a href="#Tracing-Metadata-Key">Key</a></code></td>
<td>
<p>Defines the path used to retrieve the tag value.</p>

</td>
<td>
No
</td>
</tr>
<tr id="Tracing-Metadata-default_value">
<td><code>defaultValue</code></td>
<td><code>string</code></td>
<td>
<p>Optional. If the key is not found, this value will be
used instead.</p>

</td>
<td>
No
</td>
</tr>
</tbody>
</table>
</section>
<h2 id="Tracing-Metadata-Key">Tracing.Metadata.Key</h2>
<section>
<table class="message-fields">
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
<th>Required</th>
</tr>
</thead>
<tbody>
<tr id="Tracing-Metadata-Key-key">
<td><code>key</code></td>
<td><code>string</code></td>
<td>
<p>Required. The key name of Metadata to retrieve the Struct from the
metadata. Typically, it represents a builtin subsystem or custom
extension.</p>

</td>
<td>
No
</td>
</tr>
<tr id="Tracing-Metadata-Key-segment">
<td><code>segment</code></td>
<td><code><a href="#Tracing-Metadata-Key-PathSegment">PathSegment[]</a></code></td>
<td>
<p>Required. Specifies the segment in a path to retrieve the value.</p>

</td>
<td>
No
</td>
</tr>
</tbody>
</table>
</section>
<h2 id="Tracing-Metadata-Key-PathSegment">Tracing.Metadata.Key.PathSegment</h2>
<section>
<p>One segment of a path to a Metadata value.</p>

<table class="message-fields">
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
<th>Required</th>
</tr>
</thead>
<tbody>
<tr id="Tracing-Metadata-Key-PathSegment-key">
<td><code>key</code></td>
<td><code>string</code></td>
<td>
<p>Key to retrieve the value in a Struct.</p>

</td>
<td>
No
</td>
</tr>
</tbody>
</table>
</section>
<h2 id="TelemetryRuleMatch-TrafficDirection">TelemetryRuleMatch.TrafficDirection</h2>
<section>
<p>TrafficDirection selects for traffic relative to the local
proxy.</p>

<table class="enum-values">
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr id="TelemetryRuleMatch-TrafficDirection-ALL_DIRECTIONS">
<td><code>ALL_DIRECTIONS</code></td>
<td>
<p>(Default) Match all traffic, regardless of direction.</p>

</td>
</tr>
<tr id="TelemetryRuleMatch-TrafficDirection-OUTBOUND">
<td><code>OUTBOUND</code></td>
<td>
<p>Match outbound traffic leaving the proxy. Use this to select &ldquo;client-side&rdquo;
traffic in telemetry reporting.
Note: Use OUTBOUND for gateways (even including ingress)</p>

</td>
</tr>
<tr id="TelemetryRuleMatch-TrafficDirection-INBOUND">
<td><code>INBOUND</code></td>
<td>
<p>Match incoming traffic for the proxy. Use this to select &ldquo;server-side&rdquo;
traffic in telemetry reporting.</p>

</td>
</tr>
</tbody>
</table>
</section>
<h2 id="Tracing-Metadata-Kind">Tracing.Metadata.Kind</h2>
<section>
<table class="enum-values">
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr id="Tracing-Metadata-Kind-REQUEST">
<td><code>REQUEST</code></td>
<td>
<p>Represents dynamic metadata associated with the request</p>

</td>
</tr>
<tr id="Tracing-Metadata-Kind-ROUTE">
<td><code>ROUTE</code></td>
<td>
<p>Represents metadata from the route.</p>

</td>
</tr>
<tr id="Tracing-Metadata-Kind-CLUSTER">
<td><code>CLUSTER</code></td>
<td>
<p>Represents metadata from the upstream cluster.</p>

</td>
</tr>
<tr id="Tracing-Metadata-Kind-HOST">
<td><code>HOST</code></td>
<td>
<p>Represents metadata from the upstream host.</p>

</td>
</tr>
</tbody>
</table>
</section>
<h2 id="ConstantSampler-ConstantDecision">ConstantSampler.ConstantDecision</h2>
<section>
<p>ConstantDecision controls the behavior of the ConstantSampler.</p>

<table class="enum-values">
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr id="ConstantSampler-ConstantDecision-DECISION_UNSPECIFIED">
<td><code>DECISION_UNSPECIFIED</code></td>
<td>
<p>Equivalent to NEVER_SAMPLE.</p>

</td>
</tr>
<tr id="ConstantSampler-ConstantDecision-NEVER">
<td><code>NEVER</code></td>
<td>
<p>Ignore all sidecar traffic for the purposes of telemetry generation.
For tracing, this means that the sidecar will never generate trace spans
for traffic without an existing trace context.</p>

</td>
</tr>
<tr id="ConstantSampler-ConstantDecision-ALWAYS">
<td><code>ALWAYS</code></td>
<td>
<p>Consider all sidecar traffic for the purposes of telemetry generation.
For tracing, this will generate trace spans for traffic without an
existing trace context.</p>

</td>
</tr>
</tbody>
</table>
</section>
